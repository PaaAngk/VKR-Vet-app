<div class="flex flex-col space-y-3 max-h-full p-0" *ngIf="true">

    <!-- Header -->
    <div class="p-2 rounded-lg bg-white shadow-md">
        <div tuiTextfieldSize="m" class="flex flex-row items-center gap-2">
            <p class="text-base md:basis-3/6 basis-full">
                <b class="mx-4 text-xl">{{ pet.alias }} </b> 
                Вид: <b class="mr-4">{{ pet.kind }}</b> 
                Дата рождения: <b class="mr-4">{{pet.DOB | date:'dd/MM/yyy' | checkNull}}</b>
            </p>
            <div
                tuiGroup
                class="group md:basis-1/6 basis-full"
                [collapsed]="true"
            >
                <button
                    tuiButton
                    type="button"
                    appearance="secondary-destructive"
                    size="m"
                    (click)="showDialogEditPet()"
                >
                    Изменить
                </button>
                <button
                    tuiButton
                    type="button"
                    appearance="accent"
                    size="m"
                    (click)="deletePet(template)"
                >
                    Удалить
                </button>
            </div>

            <div 
                tuiGroup
                class="group md:basis-2/6 basis-full"
            >
                <button
                    tuiButton
                    icon="tuiIconFileLarge"
                    size="m"
                    routerLink="reception/new"
                >
                    <p class="text-base">
                        Добавить прием
                    </p>
                </button>
                <button
                    tuiButton
                    icon="tuiIconThermometerLarge"
                    size="m"
                >
                    <p class="text-base">
                        Добавить анализы
                    </p>
                </button>
            </div>
        </div>
    </div>

    <!-- Main part -->
    <div class="rounded-lg bg-white shadow-md h-full">
        <!-- Menu -->
        <tui-tabs [(activeItemIndex)]="activeItemIndex" class="">
            <button
                tuiTab
            >
                <p class="ml-4 mr-2">Данные питомца</p> 
            </button>
            <button
                tuiTab
            >
                Приемы
            </button>
            <button
                tuiTab
            >
                Анализы и исследования
            </button>
        </tui-tabs>

        <div class="p-2 shadow-inner overflow-auto" [ngStyle]="{'max-height':'75vh'}">
            <!-- Pet data -->
            <div class="text-xl text-center space-y-1 divide-y divide-slate-300 py-0" *ngIf="activeItemIndex === 0">
                <p> <b>Кличка: </b> {{ pet.alias }}</p>
                <p> <b>Вид: </b> {{ pet.kind }}</p>
                <p> <b>Порода: </b> {{ pet.breed  | checkNull }}</p>
                <p> <b>Питание: </b> {{ pet.nutrition  | checkNull }}</p>
                <p> <b>Вес: </b> {{ pet.weight  | checkNull }} {{pet.weight ? "кг" : ""}}</p>
                <p> <b>Дата рождения: </b> {{ pet.DOB | date:'dd/MM/yyy' | checkNull }}</p>
                <p> <b>Окрас: </b> {{ pet.color  | checkNull }}</p>
                <p> <b>Пол: </b> {{ pet.gender | formatPetGender }}</p>
                <p> <b>Наличие кастрации: </b> {{ pet.castration ? "Есть" : pet.castration === null ? "Нет данных" : "Нет"}}</p>
                <p> <b>Диагноз: </b> {{ pet.diagnosis  | checkNull }} </p>
                <p> <b>Особые отметки: </b> {{ pet.notes  | checkNull }}</p>
            </div>

            <!-- Reception -->
            <div class="h-full" *ngIf="activeItemIndex === 1">

                <table
                    class="w-full"
                    tuiTable
                    [columns]="receptionColumns"
                    *ngIf="receptions.length !== 0"
                >
                    <thead>
                        <tr tuiThGroup>
                            <th
                                *tuiHead="'receptionPurpose'"
                                class="w-56"
                                tuiTh
                                [sorter]="null"
                            >
                                Вид приема
                            </th>
                            <th
                                *tuiHead="'diagnosis'"
                                tuiTh
                                [sorter]="null"
                            >
                                Диагноз
                            </th>
                            <th
                                *tuiHead="'date'"
                                tuiTh
                            >
                                Дата
                            </th>
                            <th
                                *tuiHead="'cost'"
                                tuiTh
                            >
                                Стоимость
                            </th>
                            <th
                                *tuiHead="'actions'"
                                tuiTh
                                class="lg:w-32"
                                [sorter]="null"
                            >Действия</th>
                        </tr>
                    </thead>
                    <tbody
                        *tuiLet="receptions | tuiTableSort as sortedReceptions"
                        tuiTbody
                        [data]="sortedReceptions"
                    >
                        <tr
                            *ngFor="let reception of sortedReceptions; let index = index"
                            tuiTr
                        >
                            <td
                                *tuiCell="'receptionPurpose'"
                                tuiTd
                            >
                                <b>{{ reception.purpose?.purposeName }}</b>
                            </td>
                            <td
                                *tuiCell="'diagnosis'"
                                tuiTd
                            >
                                {{ reception.diagnosis | checkNull}}
                            </td>
                            <td
                                *tuiCell="'date'"
                                tuiTd
                            >
                                {{ reception.createdAt | date:'dd/MM/yyy' | checkNull }}
                            </td>
                            <td
                                *tuiCell="'cost'"
                                tuiTd
                            >
                                {{ reception.cost | checkNull}} 
                                <ng-container *ngIf="reception.cost">₽</ng-container>
                            </td>
                            <td
                                *tuiCell="'actions'"
                                class="space-x-2"
                                tuiTd
                            >
                                <button
                                    tuiButton
                                    size="s"
                                    [routerLink]="['reception', reception.id]"
                                >
                                    Просмотр
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <h3
                    *ngIf="receptions.length === 0"
                    class="text-2xl py-2 font-bold text-center"
                >
                    Нет добавленных приемов
                </h3>
                
            </div>
            

            <!-- Analyzes -->
            <div class="" *ngIf="activeItemIndex === 2">
                <table
                    class="w-full"
                    tuiTable
                    [columns]="analyzesColumns"
                    *ngIf="analyzesResearchs.length !== 0"
                >
                    <thead>
                        <tr tuiThGroup>
                            <th
                                *tuiHead="'type'"
                                class="w-56"
                                tuiTh
                                [sorter]="null"
                            >
                                Вид
                            </th>
                            <th
                                *tuiHead="'date'"
                                tuiTh
                            >
                                Дата
                            </th>                        
                            <th
                                *tuiHead="'actions'"
                                tuiTh
                                class="lg:w-32"
                                [sorter]="null"
                            >Действия</th>
                        </tr>
                    </thead>
                    <tbody
                        tuiTbody
                        [data]="analyzesResearchs"
                    >
                        <tr
                            *ngFor="let analyzesResearch of analyzesResearchs; let index = index"
                            tuiTr
                        >
                            <td
                                *tuiCell="'type'"
                                tuiTd
                            >
                                <b>{{ analyzesResearch.type.typeName }}</b>
                            </td>
                            <td
                                *tuiCell="'date'"
                                tuiTd
                            >
                                {{ analyzesResearch.createdAt | date:'dd/MM/yyy' | checkNull }}
                            </td>
                            <td
                                *tuiCell="'actions'"
                                class="space-x-2"
                                tuiTd
                            >
                                <button
                                    tuiButton
                                    size="s"
                                >
                                    Просмотр
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <h3
                    *ngIf="analyzesResearchs.length === 0"
                    class="text-2xl py-2 font-bold text-center"
                >
                    Нет добавленных анализов и исследований
                </h3>
            </div>
        </div>
        
    </div>
</div>


<ng-template
    #template
    let-observer
>
    <p class="mb-2">{{pet.alias}} <br> <i>Все приемы и анализы будут удалены!</i></p>
    <div class="flex justify-around">
        <button
            tuiButton
            type="button"
            size="m"
            appearance="accent"
            class="bg-slate-500"
            (click)="observer.next()"
        >
            Удалить
        </button>
        <button
            tuiButton
            type="button"
            size="m"
            (click)="observer.complete()"
        >
            Отмена
        </button>
    </div>
</ng-template>